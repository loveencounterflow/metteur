{
  "version": 3,
  "file": "",
  "sourceRoot": "",
  "sources": [
    "../src/main.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "\n\n'use strict'\n\n\n############################################################################################################\nGUY                       = require 'guy'\n{ debug\n  info\n  whisper\n  warn\n  urge\n  help }                  = GUY.trm.get_loggers 'METTEUR'\n{ rpr\n  echo }                  = GUY.trm\nPATH                      = require 'path'\nFS                        = require 'fs'\nresolve                   = ( P... ) -> PATH.resolve PATH.join __dirname, '..', P...\ntypes                     = require './types'\n{ hide }                  = GUY.props\n{ freeze }                = GUY.lft\n# { equals }                = types\n# { HDML }                  = require 'hdml'\npage_template             = \"\"\"\n  \\\\begin{tikzpicture}[overlay,remember picture]\n  \\\\node[anchor=north west,xshift=❰xshift❱mm,yshift=❰yshift❱mm] at (current page.north west){\n    \\\\fbox{\\\\includegraphics[width=❰width❱mm,height=❰height❱mm,angle=❰angle❱,page=❰page_nr❱]{❰source_path❱}}};\n    \\\\end{tikzpicture}\"\"\".replace /\\s*\\n\\s*/g, ''\n\nlayout =\n  orientation: 'ltr' # or 'rtl' which will invert the orientation of all pages, allowing for CJK, Arabic RTL books\n  recto:\n    left:   [  4, 13, 16,  1, ]\n    right:  [  5, 12,  9,  8, ]\n  verso:\n    left:   [  6, 11, 10,  7, ]\n    right:  [  3, 14, 15,  2, ]\n\n\n#===========================================================================================================\n# types.declare 'tmpltr_cfg',\n\n#===========================================================================================================\nclass @Template extends GUY.props.Strict_owner\n\n  #---------------------------------------------------------------------------------------------------------\n  constructor: ( cfg ) ->\n    super()\n    hide @, 'types', types\n    @cfg    = new GUY.props.Strict_owner { target: ( @types.create.mtr_new_template cfg ), freeze: true, }\n    #.......................................................................................................\n    open    = @_escape_literal_for_regex @cfg.open\n    close   = @_escape_literal_for_regex @cfg.close\n    hide @, '_cfg', freeze\n      open:   open\n      close:  close\n      rx:     /// #{open} (?<key>[^#{close}]*) #{close} ///g\n    #.......................................................................................................\n    # for\n    return undefined\n\n  #---------------------------------------------------------------------------------------------------------\n  fill: ( cfg ) ->\n    cfg = @types.create.mtr_template_fill cfg\n    R   = @cfg.template\n    R   = R.replace @_cfg.rx, ( _..., { key, } ) ->\n      # if key.startsWith '...'\n      #   key = key[ 3 ... ]\n      unless ( value = cfg[ key ] )?\n        throw new Error \"unknown key #{rpr groups.key}\"\n      return value\n    return R\n\n  #---------------------------------------------------------------------------------------------------------\n  ### thx to https://stackoverflow.com/a/6969486/7568091 and\n  https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions#escaping ###\n  _escape_literal_for_regex: ( literal ) -> literal.replace /[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'\n\n\n\n#===========================================================================================================\nclass Metteur extends GUY.props.Strict_owner\n\n  #---------------------------------------------------------------------------------------------------------\n  constructor: ( cfg ) ->\n    super()\n    return undefined\n\n#-----------------------------------------------------------------------------------------------------------\n@demo = ->\n  template_path   = resolve 'tex/booklet.template.tex'\n  tex_target_path = resolve 'tex/booklet.tex'\n  source_path     = resolve '../metteur-booklets/textura.booklet.pdf'\n  # source_path     = resolve '16-page-booklet.pdf'\n  template        = FS.readFileSync template_path, { encoding: 'utf-8', }\n  #.........................................................................................................\n  Q               =\n    # frame_weight:     '0.25mm'\n    frame_weight:     '0mm'\n  #.........................................................................................................\n  # correction      = { x: -3.5, y: +3.5, }\n  correction      = { x: -2, y: +1.5, }\n  ### TAINT precompute using named values ###\n  width           = 297 / 4\n  height          = 210 / 2\n  orientation     = if layout.orientation is 'ltr' then +1 else -1\n  for side in [ 'recto', 'verso', ]\n    template = template.replace /(?=❰\\.\\.\\.content❱)/g, '\\\\newpage%\\n' if side is 'verso'\n    sheet = layout[ side ]\n    for column in [ 'left', 'right', ]\n      ### TAINT precompute using named values ###\n      if column is 'left'\n        xshift  = 0 + correction.x\n        angle   = -90 * orientation\n      else\n        xshift  = 210 / 2 + correction.x\n        angle   = +90 * orientation\n      for page_nr, page_idx in sheet[ column ]\n        yshift = -( 297 / 4 ) * page_idx + correction.y ### TAINT precompute using named values ###\n        page  = page_template\n        page  = page.replace /❰xshift❱/g,   xshift\n        page  = page.replace /❰yshift❱/g,   yshift\n        page  = page.replace /❰angle❱/g,    angle\n        page  = page.replace /❰width❱/g,    width\n        page  = page.replace /❰height❱/g,   height\n        page  = page.replace /❰page_nr❱/g,  page_nr\n        page  = page.replace /❰source_path❱/g,  source_path\n        page += \" % #{side} #{column} r#{page_idx + 1} p#{page_nr}\\n\"\n        template = template.replace /(?=❰\\.\\.\\.content❱)/g, page\n  template = template.replace /❰\\.\\.\\.content❱/g, ''\n  template = template.replace /❰frame_weight❱/g, Q.frame_weight\n  # template = @interpolate template, Q\n  FS.writeFileSync tex_target_path, template\n  help \"wrote output to #{tex_target_path}\"\n  return null\n\n\n############################################################################################################\nif module is require.main then do =>\n  await @demo()\n"
  ]
}
{
  "version": 3,
  "file": "",
  "sourceRoot": "",
  "sources": [
    "../src/cli.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "\n\n'use strict'\n\n\n############################################################################################################\nGUY                       = require 'guy'\n{ debug\n  info\n  whisper\n  warn\n  urge\n  help }                  = GUY.trm.get_loggers 'METTEUR/cli'\n{ rpr\n  echo }                  = GUY.trm\n#...........................................................................................................\nPATH                      = require 'node:path'\nFS                        = require 'fs-extra'\nCP                        = require 'node:child_process'\ntypes                     = require './types'\n{ isa\n  validate }              = types\nMIXA                      = require 'mixa'\nGUY                       = require 'guy'\n{ lime\n  blue\n  grey }                  = GUY.trm\n{ Metteur }               = require './main'\n{ to_width }              = require 'to-width'\n\n#-----------------------------------------------------------------------------------------------------------\nresolve = ( P... ) ->\n  return PATH.resolve PATH.join P... if P[ 0 ].startsWith '/'\n  return PATH.resolve PATH.join process.env.cwd, P...\n\n#-----------------------------------------------------------------------------------------------------------\nrun_tex_etc = ( cfg ) ->\n  GUY.temp.with_directory { keep: false, }, ({ path }) ->\n    cfg.tex_working_path  = path\n    cfg.tex_target_path   = resolve cfg.tex_working_path, 'booklet.tex'\n    cfg.tex_pdf_path      = resolve cfg.tex_working_path, 'booklet.pdf'\n    FS.writeFileSync cfg.tex_target_path, cfg.imposition\n    whisper \"wrote imposition to #{cfg.tex_target_path}\"\n    await _run_tex cfg\n    FS.moveSync cfg.tex_pdf_path, cfg.output, { overwrite: cfg.overwrite, }\n    help \"wrote output to #{cfg.output}\"\n    return null\n  return cfg\n\n#-----------------------------------------------------------------------------------------------------------\n_run_tex = ( cfg ) ->\n  await import( 'zx/globals' )\n  #---------------------------------------------------------------------------------------------------------\n  $$ = ( P... ) -> ( await $ P... ).stdout.trim()\n  path_from_executable_name = ( name ) ->\n    try return await $$\"\"\"command -v #{name}\"\"\" catch error\n      warn \"^6456^\", \"\"\"\n        unable to locate #{name};\n        please refer to [section *External Dependencies*](https://github.com/loveencounterflow/metteur#external-dependencies) in the README.md\"\"\"\n      throw error\n  #---------------------------------------------------------------------------------------------------------\n  paths =\n    xelatex: await path_from_executable_name 'xelatex'\n  #---------------------------------------------------------------------------------------------------------\n  debug '^43345^', paths\n  cd cfg.tex_working_path\n  await $\"\"\"time #{paths.xelatex} --halt-on-error booklet.tex > xelatex-output\"\"\"\n  await $\"\"\"time #{paths.xelatex} --halt-on-error booklet.tex > xelatex-output\"\"\"\n  # debug '^43345^', cfg\n  return null\n\n\n#===========================================================================================================\n#\n#-----------------------------------------------------------------------------------------------------------\n@cli = ->\n  #.........................................................................................................\n  jobdefs =\n    # meta:\n    commands:\n      #-----------------------------------------------------------------------------------------------------\n      'help':\n        runner: ( d ) =>\n          debug '^690-1^', process.argv\n          echo lime \"\"\"Metteur: produce impositions for booklets with 4, 8 or 16 pages arranged on one sheet\"\"\"\n          echo blue \"\"\"\n            Usage:\n              metteur impose [flags]\n                --input       -i\n                --overwrite   -y\n                --output      -o\n            \"\"\"\n      #-----------------------------------------------------------------------------------------------------\n      'impose':\n        description:  \"assemble pages from one PDF file into a new PDF, to be folded into a booklet\"\n        runner: ( d ) =>\n          cfg             = types.create.mtr_cli_impose_cfg d.verdict.parameters\n          cfg.input       = resolve cfg.input\n          cfg.output      = resolve cfg.output\n          whisper()\n          whisper \"#{to_width \"#{key}:\", 20} #{value}\" for key, value of cfg\n          whisper()\n          mtr = new Metteur()\n          cfg.imposition  = mtr.impose cfg\n          await run_tex_etc cfg\n          return null\n        flags:\n          'input':\n            alias:        'i'\n            type:         String\n            # positional:   true\n            # multiple:     'greedy'\n            description:  \"input file (providing the individual pages)\"\n          'output':\n            alias:        'o'\n            type:         String\n            # positional:   true\n            description:  \"output file (containing the booklet with multiple pages per sheet, front and back)\"\n          'overwrite':\n            alias:        'y'\n            type:         Boolean\n            # positional:   true\n            description:  \"whether to overwrite output file\"\n      #-----------------------------------------------------------------------------------------------------\n      # 'tex':\n      #   description:  \"run XeLaTeX on tex/booklet.tex to produce tex/booklet.pdf\"\n        # runner: run_tex\n  #.........................................................................................................\n  MIXA.run jobdefs, process.argv\n  return null\n\n\n\n############################################################################################################\nif module is require.main then do =>\n  # await demo_receiver()\n  await @cli()\n\n\n"
  ]
}
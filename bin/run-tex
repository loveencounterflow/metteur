#!/usr/bin/env bash

set -euo pipefail

#-----------------------------------------------------------------------------------------------------------
# cwd=$(pwd)
home="$(realpath "$(realpath "${BASH_SOURCE[0]}" | xargs dirname)"/..)"; cd "$home" || enodir
source bin/_lxu-utils

#-----------------------------------------------------------------------------------------------------------
set +e; xelatex_cmd=$( command -v xelatex || enocmd 'xelatex' ); set -e
set +e; trash_cmd=$( command -v trash || enocmd 'trash' ); set -e
echo "using $xelatex_cmd"

#-----------------------------------------------------------------------------------------------------------
### TAINT find out whether 2nd run necessary ###
cd tex
"$trash_cmd" booklet.aux booklet.log

#-----------------------------------------------------------------------------------------------------------
echo "first run of $xelatex_cmd; output in tex/xelatex-output"
time "$xelatex_cmd" --halt-on-error booklet.tex > xelatex-output
### TAINT deal with errors here ###

#-----------------------------------------------------------------------------------------------------------
echo "second run of $xelatex_cmd; output in tex/xelatex-output"
time "$xelatex_cmd" --halt-on-error booklet.tex > xelatex-output
### TAINT deal with errors here ###


